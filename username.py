import requests
from bs4 import BeautifulSoup
import re

url = input("Enter the URL of the WordPress website: ").strip()

# Get the base URL without any trailing slash
base_url = url.rstrip('/')

# Compile the author pattern with the base URL
username_pattern = re.compile(rf'{re.escape(base_url)}/author/([^/]+)/?$')

author_num = 1
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'
}

# Create a session object
session = requests.Session()

# Create a list to store the usernames
usernames = []

while True:
    new_url = base_url + "?author=" + str(author_num)

    # Use the session object to make the request
    response = session.get(new_url, headers=headers)
    print(response.url)

    # Check if the page has been redirected
    if response.url != new_url and response.url == base_url:
        print("Page redirected...")
        break

    # Check if the URL format has changed
    if response.url != new_url:
        match = username_pattern.search(response.url)
        if match:
            username = match.group(1)
            print(f"Found author with ID {author_num}: {username}")
            usernames.append("ID " + str(author_num) + ": " + username)

    # Check if the response is successful (status code 200)
    if response.status_code == 200:
        soup = BeautifulSoup(response.content, 'html.parser')

        # Check if the tag with class 'author-title' exists
        author_name_tag = soup.find('h1', class_='author-title')
        if author_name_tag is not None:
            author_name = author_name_tag.text.strip()
            print(f"Found author with ID {author_num}: {author_name}")
            usernames.append("ID " + str(author_num) + ": " + author_name)

        else:
            print("Tag not found")
        author_num += 1

    # Check if the response is 404 (no more authors found)
    elif response.status_code == 404:
        print(f"No more authors found.")
        break

    # Unexpected response
    else:
        print(f"Unexpected response: {response.status_code}")
        break





# Create the file name using the URL and usernames
file_name = f"{base_url[8:]} usernames.txt"

# Write the usernames to the file
with open(file_name, 'w+', encoding='utf-8') as file:
    for username in usernames:
        file.write(username + '\n')

print(f"Usernames saved to {file_name}.")
